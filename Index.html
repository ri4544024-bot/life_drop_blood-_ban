<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Drop - Blood Donor Network</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --blood-red: #d90429; --dark-blue: #2b2d42; }
        body { background-color: #edf2f4; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hero { background: var(--blood-red); color: white; padding: 60px 0; text-align: center; border-radius: 0 0 40px 40px; }
        .nav-card { cursor: pointer; transition: 0.3s; border: none; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); background: white; height: 100%; }
        .nav-card:hover { transform: translateY(-8px); box-shadow: 0 15px 35px rgba(217, 4, 41, 0.2); }
        .hidden-section { display: none; }
        .btn-danger { background-color: var(--blood-red); border: none; font-weight: 600; }
        .donor-card { border-left: 6px solid var(--blood-red); border-radius: 12px; background: #fff; }
        .back-btn { font-size: 14px; margin-bottom: 20px; color: var(--dark-blue); cursor: pointer; border: 1px solid #ccc; padding: 6px 18px; border-radius: 25px; display: inline-block; background: white; }
    </style>
</head>
<body>

<div class="hero mb-5">
    <h1>ü©∏ Life Drop</h1>
    <p>Connecting life-savers across 64 districts</p>
</div>

<div class="container pb-5">
    <div class="row g-4 justify-content-center" id="main-nav">
        <div class="col-md-5">
            <div class="card nav-card p-5 text-center" onclick="showSection('search-section')">
                <div style="font-size: 60px;">üîç</div>
                <h3 class="mt-3">Find Blood</h3>
                <p class="text-muted">Search for donors by group and district</p>
            </div>
        </div>
        <div class="col-md-5">
            <div class="card nav-card p-5 text-center" onclick="showSection('reg-section')">
                <div style="font-size: 60px;">üìù</div>
                <h3 class="mt-3">Become a Donor</h3>
                <p class="text-muted">Register your details to save lives</p>
            </div>
        </div>
    </div>

    <div id="search-section" class="hidden-section">
        <div class="back-btn" onclick="showMain()">‚Üê Back to Home</div>
        <div class="card p-4 shadow-sm border-0">
            <h4 class="mb-4 text-center">üîç Search for Donors</h4>
            <div class="row g-3">
                <div class="col-md-5">
                    <label class="form-label">Blood Group</label>
                    <select id="searchGroup" class="form-select">
                        <option value="">Select Group...</option>
                        <option value="A+">A+</option><option value="B+">B+</option>
                        <option value="O+">O+</option><option value="AB+">AB+</option>
                        <option value="A-">A-</option><option value="B-">B-</option>
                        <option value="O-">O-</option><option value="AB-">AB-</option>
                    </select>
                </div>
                <div class="col-md-5">
                    <label class="form-label">District</label>
                    <select id="searchLocation" class="form-select district-list">
                        <option value="">Select District...</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button class="btn btn-danger w-100 py-2" onclick="searchDonors()">SEARCH</button>
                </div>
            </div>
            <hr class="my-4">
            <div id="donorDisplay" class="row"></div>
        </div>
    </div>

    <div id="reg-section" class="hidden-section">
        <div class="back-btn" onclick="showMain()">‚Üê Back to Home</div>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4 shadow-sm border-0">
                    <h4 class="text-danger mb-4 text-center">üìù Donor Registration</h4>
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="name" class="form-control" placeholder="e.g. John Doe">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Blood Group</label>
                        <select id="bloodGroup" class="form-select">
                            <option value="A+">A+</option><option value="B+">B+</option>
                            <option value="O+">O+</option><option value="AB+">AB+</option>
                            <option value="A-">A-</option><option value="B-">B-</option>
                            <option value="O-">O-</option><option value="AB-">AB-</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">District</label>
                        <select id="location" class="form-select district-list"></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone Number</label>
                        <input type="text" id="phone" class="form-control" placeholder="017xxxxxxxx">
                    </div>
                    <button class="btn btn-danger w-100 p-2 mt-2" onclick="saveDonor()">REGISTER NOW</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ==========================================
    // MARK: YOUR FIREBASE CONFIG APPLIED HERE
    // ==========================================
    const firebaseConfig = {
      apiKey: "AIzaSyByGjzetBBww5TCg7sn3EhPinnzzKgacHk",
      authDomain: "life-drop-ec6c8.firebaseapp.com",
      databaseURL: "https://life-drop-ec6c8-default-rtdb.firebaseio.com",
      projectId: "life-drop-ec6c8",
      storageBucket: "life-drop-ec6c8.firebasestorage.app",
      messagingSenderId: "166551905890",
      appId: "1:166551905890:web:a5395a9778b6984ddc133b",
      measurementId: "G-JXG9JXQ7ZQ"
    };
    // ==========================================

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const districts = ["Dhaka","Chattogram","Barisal","Khulna","Rajshahi","Rangpur","Sylhet","Mymensingh","Bagerhat","Bandarban","Barguna","Bhola","Bogra","Brahmanbaria","Chandpur","Chapai Nawabganj","Chuadanga","Comilla","Cox's Bazar","Dinajpur","Faridpur","Feni","Gaibandha","Gazipur","Gopalganj","Habiganj","Jamalpur","Jessore","Jhalokati","Jhenaidah","Joypurhat","Khagrachhari","Kishoreganj","Kurigram","Kushtia","Lakshmipur","Lalmonirhat","Madaripur","Magura","Manikganj","Maulvibazar","Meherpur","Munshiganj","Naogaon","Narail","Narayanganj","Narsingdi","Natore","Netrokona","Nilphamari","Noakhali","Pabna","Panchagarh","Patuakhali","Pirojpur","Rajbari","Rangamati","Satkhira","Shariatpur","Sherpur","Sirajganj","Sunamganj","Tangail","Thakurgaon"];

    document.querySelectorAll('.district-list').forEach(select => {
        districts.sort().forEach(d => select.add(new Option(d, d)));
    });

    window.showSection = (id) => {
        document.getElementById('main-nav').style.display = 'none';
        document.getElementById(id).style.display = 'block';
    }
    window.showMain = () => {
        document.getElementById('search-section').style.display = 'none';
        document.getElementById('reg-section').style.display = 'none';
        document.getElementById('main-nav').style.display = 'flex';
    }

    window.saveDonor = async () => {
        const name = document.getElementById('name').value;
        const bloodGroup = document.getElementById('bloodGroup').value;
        const location = document.getElementById('location').value;
        const phone = document.getElementById('phone').value;

        if(!name || !phone) return alert("Please fill in all fields!");

        try {
            await addDoc(collection(db, "donors"), { name, bloodGroup, location, phone });
            alert("Registered successfully!");
            showMain();
        } catch (e) { alert("Error: " + e.message); }
    }

    window.searchDonors = async () => {
        const group = document.getElementById('searchGroup').value;
        const loc = document.getElementById('searchLocation').value;
        const display = document.getElementById('donorDisplay');
        
        if(!group || !loc) return alert("Select both group and district!");

        display.innerHTML = "<p class='text-center w-100'>Searching...</p>";
        const q = query(collection(db, "donors"), where("bloodGroup", "==", group), where("location", "==", loc));
        const snap = await getDocs(q);
        
        display.innerHTML = "";
        if(snap.empty) {
            display.innerHTML = "<div class='alert alert-warning text-center w-100'>No donors found.</div>";
            return;
        }

        snap.forEach(doc => {
            const d = doc.data();
            display.innerHTML += `<div class="col-md-6 mb-3"><div class="card p-3 donor-card shadow-sm border-0"><h5>${d.name} (${d.bloodGroup})</h5><p class="mb-1 text-muted small">üìç District: ${d.location}</p><a href="tel:${d.phone}" class="btn btn-outline-success btn-sm w-100 mt-2">üìû Call Now: ${d.phone}</a></div></div>`;
        });
    }
</script>
</body>
</html>
